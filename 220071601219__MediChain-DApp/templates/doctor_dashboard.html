{% extends "base.html" %}
{% block content %}
<h2>Welcome, Dr. {{ name }}!</h2>
<h5>Role: {{ role.capitalize() }}</h5>
<hr>

<div class="row mb-4">
    <div class="col-md-6">
        <h4>Your Information</h4>
        <ul class="list-group">
            {% for key, value in user_info.items() %}
                <li class="list-group-item"><strong>{{ key }}:</strong> {{ value }}</li>
            {% endfor %}
        </ul>
    </div>
    <div class="col-md-6">
        <h4>Your Transactions</h4>
        {% if transactions %}
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead>
                        <tr>
                            <th>Transaction ID</th>
                            <th>Sender</th>
                            <th>Receiver</th>
                            <th>Value (Wei)</th>
                            <th>Settled</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for txn in transactions %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ txn['Sender'] }}</td>
                                <td>{{ txn['Receiver'] }}</td>
                                <td>{{ txn['Value'] }}</td>
                                <td>{{ 'Yes' if txn['Settled'] else 'No' }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <!-- Pagination Controls -->
            <nav aria-label="Transactions Pagination">
                <ul class="pagination justify-content-center" id="transactionPagination">
                    <!-- Pagination items will be generated by JavaScript -->
                </ul>
            </nav>
        {% else %}
            <p>No transactions found.</p>
        {% endif %}
    </div>
</div>

<!-- Manage Patients Section -->
<div class="row mb-4">
    <div class="col-12">
        <h4>Your Patients</h4>
        {% if patients %}
            <div class="table-responsive">
                <table class="table table-bordered align-middle">
                    <thead>
                        <tr>
                            <th>Patient Name</th>
                            <th>Ethereum Address</th>
                            <th>Medical Records</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for patient in patients %}
                            <tr>
                                <td>{{ patient['name'] }}</td>
                                <td>{{ patient['address'] }}</td>
                                <td>
                                    {% if patient['medicalRecords'] %}
                                        <ul class="list-group">
                                            {% for record in patient['medicalRecords'] %}
                                                <li class="list-group-item">
                                                    <a href="https://ipfs.io/ipfs/{{ record }}" target="_blank">{{ record }}</a>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    {% else %}
                                        <p>No medical records.</p>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{{ url_for('update_medical_record_page', patient_address=patient['address']) }}" class="btn btn-primary btn-sm">Update Record</a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p>You currently have no patients assigned.</p>
        {% endif %}
    </div>
</div>

{% endblock %}
